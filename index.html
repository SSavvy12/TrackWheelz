<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>Track Wheelz - Home</title>
  <link rel="stylesheet" href="style.css"/>
</head>
<body>
  <header>
    <h1>Track Wheelz</h1>
    <nav>
      <a href="index.html">Home</a>
      <a href="login.html" id="loginLink">Login</a>
      <a href="signup.html">Sign Up</a>
      <a href="map.html">Map</a>
      <a href="#" id="logoutLink" style="display:none;">Logout</a>
    </nav>
  </header>
  <div class="container">
    <h2>Track Your Hot Wheels!</h2>
    <p>Find and unlock Hot Wheels lock boxes near you.</p>

    <!-- Start Tracking -->
    <button id="startBtn">Start Tracking</button>

    <!-- User-only content -->
    <div id="userContent" style="display:none;">
      <!-- 🎁 Daily Bonus -->
      <div id="dailyBonus" style="margin-top:20px; text-align:center;">
        <button id="dailyBonusBtn" style="padding:10px; border-radius:8px; background:#ff6600; color:white; font-size:16px; cursor:pointer;">
          🎁 Claim Daily Bonus
        </button>
        <p id="bonusMsg" style="margin-top:5px; font-weight:bold; color:#0066cc;"></p>
      </div>

      <!-- Progress Panel -->
      <div id="stats" style="margin-top:20px; background:#ffeb99; border:4px solid #ff6600; padding:15px; border-radius:15px; text-align:center;">
        <p style="font-size:20px;">⭐ Points: <span id="points">0</span></p>
        <p style="font-size:20px;">🏁 Level: <span id="level">1</span></p>
        <div style="background:#ddd; border-radius:12px; overflow:hidden; margin:10px auto; height:25px; width:90%;">
          <div id="progressFill" style="background:#00cc66; height:100%; width:0%; transition:width 0.5s;"></div>
        </div>
        <p id="nextLevelText"></p>
      </div>
    </div>
  </div>

  <script>
    const startBtn = document.getElementById("startBtn");
    const loginLink = document.getElementById("loginLink");
    const logoutLink = document.getElementById("logoutLink");
    const userContent = document.getElementById("userContent");
    const user = localStorage.getItem("hotwheelsUser");

    // Navbar state
    if (user) {
      loginLink.style.display = "none";
      logoutLink.style.display = "inline";
      userContent.style.display = "block"; // show bonus + stats
    }

    // Start button logic
    startBtn.addEventListener("click", () => {
      if (localStorage.getItem("hotwheelsUser")) {
        window.location.href = "map.html";
      } else {
        window.location.href = "login.html";
      }
    });

    // Logout logic
    logoutLink.addEventListener("click", () => {
      localStorage.removeItem("hotwheelsUser");
      window.location.href = "index.html";
    });

    // 🎮 Stats system
    function getUserData(username) {
      const data = JSON.parse(localStorage.getItem("hotwheelsData") || "{}");
      if (!data[username]) data[username] = { points: 0, level: 1, lastBonus: null };
      return data[username];
    }
    function saveUserData(username, stats) {
      const data = JSON.parse(localStorage.getItem("hotwheelsData") || "{}");
      data[username] = stats;
      localStorage.setItem("hotwheelsData", JSON.stringify(data));
    }

    if (user) {
      const stats = getUserData(user);

      function checkLevelUp() {
        const needed = stats.level * 150;
        if (stats.points >= needed) {
          stats.level++;
          alert(`🎉 Woohoo ${user}! You reached Level ${stats.level}!`);
        }
      }

      function updateStatsUI() {
        document.getElementById("points").textContent = stats.points;
        document.getElementById("level").textContent = stats.level;

        const needed = stats.level * 150;
        const progress = Math.min((stats.points / needed) * 100, 100);
        document.getElementById("progressFill").style.width = progress + "%";
        document.getElementById("nextLevelText").textContent = `Next level at ${needed} points`;

        saveUserData(user, stats);
        checkDailyBonus();
      }

      // 🎁 Daily Bonus
      const bonusBtn = document.getElementById("dailyBonusBtn");
      const bonusMsg = document.getElementById("bonusMsg");

      function getTodayDate() {
        const today = new Date();
        return today.toISOString().split("T")[0]; // YYYY-MM-DD
      }

      function checkDailyBonus() {
        const lastClaim = stats.lastBonus || null;
        const today = getTodayDate();
        if (lastClaim === today) {
          bonusBtn.disabled = true;
          bonusBtn.style.background = "#ccc";
          bonusMsg.textContent = "✅ Daily bonus already claimed!";
        } else {
          bonusBtn.disabled = false;
          bonusBtn.style.background = "#ff6600";
          bonusMsg.textContent = "🎁 You can claim your daily bonus!";
        }
      }

      bonusBtn.addEventListener("click", () => {
        const today = getTodayDate();
        if (stats.lastBonus !== today) {
          stats.points += 50; // reward
          stats.lastBonus = today;
          checkLevelUp();
          updateStatsUI();
          alert("🎉 You claimed your +50 Daily Bonus!");
        }
      });

      updateStatsUI();
    }
  </script>
</body>
</html>
